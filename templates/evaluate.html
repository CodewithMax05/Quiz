{% extends "base.html" %}

{% block head %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles_evaluate.css') }}"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{% endblock %}

{% block body %}    
    <div class="evaluate-container">
        <!-- Header mit Avatar und Benutzername -->
        <div class="user-header">
            <div class="avatar-section">
                <img src="{{ url_for('static', filename='pictures/avatar/' + user_avatar) }}" 
                     alt="Avatar" 
                     class="user-avatar-large">
                <div class="user-info">
                    <h2 class="username">{{ session.username }}</h2>
                    <div class="quiz-completion">Quiz abgeschlossen!</div>
                </div>
            </div>
        </div>

        <!-- Haupt-Ergebnisbereich -->
        <div class="results-main">
            <div class="score-section">
                <div class="score-circle">
                    <div class="score-number">{{ score }}</div>
                    <div class="score-label">Punkte</div>
                </div>
                
                <div class="correct-answers">
                    <div class="correct-count">
                        <span class="correct-number">{{ correct_answers }}</span>
                        <span class="correct-text">richtig</span>
                    </div>
                    <div class="total-questions">
                        von {{ total }} Fragen
                    </div>
                </div>
            </div>

            <!-- Performance-Bewertung -->
            <div class="performance-rating">
                {% if correct_answers == total %}
                    <div class="rating perfect">
                        <i class="fas fa-trophy rating-icon"></i>
                        <div class="rating-content">
                            <h3>Perfektes Ergebnis!</h3>
                            <p>Alle Fragen richtig beantwortet - herausragende Leistung!</p>
                        </div>
                    </div>
                {% elif correct_answers >= total * 0.8 %}
                    <div class="rating excellent">
                        <i class="fas fa-star rating-icon"></i>
                        <div class="rating-content">
                            <h3>Großartige Leistung!</h3>
                            <p>Du bist auf dem besten Weg zum Quiz-Meister!</p>
                        </div>
                    </div>
                {% elif correct_answers >= total * 0.65 %}
                    <div class="rating good">
                        <i class="fas fa-thumbs-up rating-icon"></i>
                        <div class="rating-content">
                            <h3>Gute Arbeit!</h3>
                            <p>Solides Wissen - nur noch wenige Lücken!</p>
                        </div>
                    </div>
                {% elif correct_answers >= total * 0.5 %}
                    <div class="rating average">
                        <i class="fas fa-rocket rating-icon"></i>
                        <div class="rating-content">
                            <h3>Weiter so!</h3>
                            <p>Die Hälfte geschafft - mit etwas Übung schaffst du mehr!</p>
                        </div>
                    </div>
                {% else %}
                    <div class="rating improve">
                        <i class="fas fa-book rating-icon"></i>
                        <div class="rating-content">
                            <h3>Lernzeit!</h3>
                            <p>Nutze die Chance, dein Wissen zu erweitern!</p>
                        </div>
                    </div>
                {% endif %}
            </div>

            <!-- Highscore-Information -->
            <div class="highscore-section">
                <div class="current-highscore">
                    <i class="fas fa-chart-line"></i>
                    <span>Dein Highscore: <strong>{{ highscore }}</strong> Punkte</span>
                </div>
                
                {% if new_highscore %}
                    <div class="new-highscore-badge">
                        <i class="fas fa-crown"></i>
                        <span>Neuer Rekord: {{ score }} Punkte!</span>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Aktions-Buttons -->
        <div class="action-buttons">
            <a href="{{ url_for('ranking') }}" class="btn ranking-btn sound-button">
                <i class="fas fa-trophy"></i>
                Ranking
            </a>
            <a href="{{ url_for('homepage') }}" class="btn home-btn sound-button">
                <i class="fas fa-home"></i>
                Zurück zur Startseite
            </a>
        </div>
    </div>

    <script>
        // Entferne das Quiz-Flag beim Beenden des Quiz
        try { 
            sessionStorage.removeItem('quiz_active'); 
        } catch (e) {
            console.warn('sessionStorage remove failed:', e);
        }

        // Animation für Score-Circle
        document.addEventListener('DOMContentLoaded', function() {
            const scoreCircle = document.querySelector('.score-circle');
            if (scoreCircle) {
                setTimeout(() => {
                    scoreCircle.classList.add('animate-score');
                }, 500);
            }
        });
    </script>
{% endblock %}