{% extends "base.html" %}

{% block head %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles_ranking.css') }}"/>
{% endblock %}

{% block body %}
    <!-- Sternenhintergrund (bleibt unverÃ¤ndert) -->
    <div class="stars-background">
        <div class="stars"></div>
        <div class="stars2"></div>
        <div class="stars3"></div>
    </div>

    <!-- Haupt-Wrapper -->
    <div class="ranking-wrapper">
        <!-- Ãœberschrift -->
        <h1>Top 10 Spieler</h1>

        <!-- Linke Spalte (Leaderboard) -->
        <div class="ranking-left">
            <div class="leaderboard">
                <div class="leaderboard-header">
                    <div class="header-item">Platz</div>
                    <div class="header-item">Username</div>
                    <div class="header-item">Punkte</div>
                    <div class="header-item">Datum</div>
                </div>
                
                <!-- Top 10 Liste (jetzt klickbar) -->
                <div class="leaderboard-content">
                    {% for player in top_players %}
                    <div class="leaderboard-row {% if loop.index <= 3 %}podium{% endif %}" 
                         data-username="{{ player.username }}"
                         data-score="{{ player.highscore }}"
                         onclick="updatePlayerInfo(this)">
                        <div class="leaderboard-cell position">
                            {% if loop.index == 1 %}ðŸ¥‡
                            {% elif loop.index == 2 %}ðŸ¥ˆ
                            {% elif loop.index == 3 %}ðŸ¥‰
                            {% else %}{{ loop.index }}{% endif %}
                        </div>
                        <div class="leaderboard-cell username">{{ player.username }}</div>
                        <div class="leaderboard-cell score">{{ player.highscore }}</div>
                        <div class="leaderboard-cell date">
                            {{ (player.highscore_time or player.first_played) | to_local_time }}
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <!-- Eigene Platzierung (bleibt unverÃ¤ndert) -->
                {% if current_player %}
                <div class="leaderboard-header platzierung-header" style="margin-top: 2rem;">
                    <div class="header-item">Deine Platzierung</div>
                    <div class="header-item"></div>
                    <div class="header-item"></div>
                    <div class="header-item"></div>
                </div>
                <div class="leaderboard-row highlight" 
                     data-username="{{ current_player.username }}"
                     data-score="{{ current_player.highscore }}"
                     onclick="updatePlayerInfo(this)">
                    <div class="leaderboard-cell position">
                        {% if player_rank %}#{{ player_rank }}
                        {% else %}N/A{% endif %}
                    </div>
                    <div class="leaderboard-cell username">{{ current_player.username }}</div>
                    <div class="leaderboard-cell score">{{ current_player.highscore }}</div>
                    <div class="leaderboard-cell date">
                        {% if current_player.highscore_time or current_player.first_played %}
                            {{ (current_player.highscore_time or current_player.first_played) | to_local_time }}
                        {% else %}
                            Noch nicht gespielt
                        {% endif %}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Rechte Spalte (Extrafeld + Button) -->
        <div class="ranking-right">
            <!-- Neues Spielerinfo-Extrafeld -->
            <div class="player-info">
                <h3>Spielerinfo</h3>
                <p>Name: <span id="info-username">{{ current_player.username if current_player else "N/A" }}</span></p>
                <p>Punkte: <span id="info-score">{{ current_player.highscore if current_player else "0" }}</span></p>
            </div>
            
            <!-- Existierender ZurÃ¼ck-Button -->
            <a href="{{ url_for('homepage') }}" class="thema-button sound-button">
                <i class="fas fa-arrow-left"></i> ZurÃ¼ck zur Themenwahl
            </a>
        </div>
    </div>

    <!-- JavaScript fÃ¼r klickbare Zeilen -->
    <script>
        // StandardmÃ¤ÃŸig eigenen Spieler auswÃ¤hlen
        document.addEventListener('DOMContentLoaded', () => {
            const defaultPlayer = document.querySelector('.leaderboard-row.highlight');
            if (defaultPlayer) {
                defaultPlayer.classList.add('active');
                // Falls kein current_player existiert, Extrafeld leeren
                if (!defaultPlayer.dataset.username) {
                    document.getElementById('info-username').textContent = "N/A";
                    document.getElementById('info-score').textContent = "0";
                }
            }
        });

        function updatePlayerInfo(row) {
            // Alle Zeilen deaktivieren
            document.querySelectorAll('.leaderboard-row').forEach(r => {
                r.classList.remove('active');
            });
            
            // Aktive Zeile hervorheben
            row.classList.add('active');
            
            // Daten ins Extrafeld Ã¼bertragen
            document.getElementById('info-username').textContent = row.dataset.username;
            document.getElementById('info-score').textContent = row.dataset.score;
        }
    </script>
{% endblock %}