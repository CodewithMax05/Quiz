{% extends "base.html" %}

{% block head %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles_news_admin.css') }}"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{% endblock %}

{% block body %}
<div class="page-wrapper">
    <div class="container">
        <h1 class="headline">News Verwaltung</h1>
        
        <div class="formatting-info-box">
            <p><strong>Formatierungs-Hinweis:</strong> Der Inhalt der News kann HTML enthalten.</p>
            <ul>
                <li>Zeilenumbruch: <code>&lt;br&gt;</code></li>
                <li>Fettgedruckt: <code>&lt;strong&gt;Text&lt;/strong&gt;</code></li>
                <li>Unterstrichen: <code>&lt;u&gt;Text&lt;/u&gt;</code></li>
                <li>Textfarbe/Styling: <code>&lt;span style="color:..."&gt;Text&lt;/span&gt;</code></li>
                <li>Kursiv: <code>&lt;em&gt;Text&lt;/em&gt;</code></li>
            </ul>
        </div>
        <div class="admin-news-list">
            <div class="admin-news-item">
                <button class="admin-news-toggle">Neue News erstellen <i class="fa fa-chevron-down"></i></button>
                <div class="admin-news-content">
                    <form method="POST">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <input type="hidden" name="action" value="create">
                        
                        <input type="text" name="title" placeholder="Titel der News" required>
                        <textarea name="content" placeholder="Inhalt der News (HTML möglich)" rows="6" required></textarea>
                        
                        <button type="submit" class="btn-create">News erstellen</button>
                    </form>
                </div>
            </div>

            {% for entry in news_entries %}
            <div class="admin-news-item">
                <button class="admin-news-toggle">
                    <span class="news-admin-title">{{ entry.title }}</span>
                    <span class="news-admin-date">{{ entry.created_at.strftime('%d.%m.%Y') }}</span>
                    <i class="fa fa-chevron-down"></i>
                </button>
                <div class="admin-news-content">
                    <form method="POST">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <input type="hidden" name="news_id" value="{{ entry.id }}">
                        
                        <input type="text" name="title" value="{{ entry.title }}" required>
                        <textarea name="content" rows="6" required>{{ entry.content }}</textarea>
                        
                        <div class="admin-news-actions">
                            <button type="submit" name="action" value="edit" class="btn-edit">
                                <i class="fas fa-save"></i> Speichern
                            </button>
                            <button type="submit" name="action" value="delete" class="btn-delete" 
                                    onclick="return confirm('News &quot;{{ entry.title }}&quot; wirklich löschen?');">
                                <i class="fas fa-trash"></i> Löschen
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="link-content">
            <a href="{{ url_for('admin_panel') }}" class="back-button1 sound-button">Zurück zum Admin-Bereich</a>
        </div>
    </div>
</div>

<script>
// Korrigierte Version - ohne Syntaxfehler
document.addEventListener('DOMContentLoaded', function() {
    const adminToggles = document.querySelectorAll('.admin-news-toggle');

    adminToggles.forEach(function(toggle) {
        toggle.addEventListener('click', function() {
            const thisContent = this.nextElementSibling;
            const thisIcon = this.querySelector('i');
            const isOpen = thisContent.style.maxHeight;

            // Schließe alle anderen
            adminToggles.forEach(function(other) {
                if (other !== toggle) {
                    const content = other.nextElementSibling;
                    const icon = other.querySelector('i');
                    content.style.maxHeight = null;
                    if (icon) {
                        icon.style.transform = 'rotate(0deg)';
                    }
                    other.classList.remove('active');
                }
            });

            // Öffne/Schließe diese
            if (!isOpen) {
                thisContent.style.maxHeight = thisContent.scrollHeight + "px";
                if (thisIcon) {
                    thisIcon.style.transform = 'rotate(180deg)';
                }
                this.classList.add('active');
            } else {
                thisContent.style.maxHeight = null;
                if (thisIcon) {
                    thisIcon.style.transform = 'rotate(0deg)';
                }
                this.classList.remove('active');
            }
        });
    });
});
</script>
{% endblock %}