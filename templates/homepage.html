{% extends "base.html" %}

{% block head %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles_homepage.css') }}"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{% endblock %}

{% block body %}
<div class="page-wrapper">
    
    <div class="container">

        <div class="header-controls">
            <button class="info-button sound-button" id="info-button" aria-label="Information">
                <i class="fas fa-question-circle"></i>
            </button>
            <a href="{{ url_for('ranking') }}" class="ranking-button sound-button" aria-label="Ranking">
                <i class="fas fa-trophy"></i>
            </a>
            <a href="{{ url_for('playermenu') }}" class="playermenu-button sound-button" aria-label="Playermenü">
                <i class="fas fa-address-card"></i>
            </a>
        </div>

        <form action="/start_custom_quiz" method="POST" class="categories-form" id="quiz-form">
            
            <h1 class="headline">Wähle deine Quiz-Kategorien</h1>

            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input type="hidden" name="random_mode" id="random-mode" value="false">
            
            <div class="category-grid">
                <label class="category-card random-mode-card">
                    <input type="checkbox" name="topics" value="random" id="random-mode-checkbox">
                    <div class="card-content">
                        <i class="fas fa-dice"></i>
                        <span>Zufällig</span>
                    </div>
                </label>
                
                <label class="category-card">
                    <input type="checkbox" name="topics" value="Musik">
                    <div class="card-content">
                        <i class="fas fa-music"></i>
                        <span>Musik</span>
                    </div>
                </label>
                
                <label class="category-card">
                    <input type="checkbox" name="topics" value="Geschichte">
                    <div class="card-content">
                        <i class="fas fa-landmark"></i>
                        <span>Geschichte</span>
                    </div>
                </label>
                
                <label class="category-card">
                    <input type="checkbox" name="topics" value="Sport">
                    <div class="card-content">
                        <i class="fas fa-football-ball"></i>
                        <span>Sport</span>
                    </div>
                </label>
                
                <label class="category-card">
                    <input type="checkbox" name="topics" value="Technologie">
                    <div class="card-content">
                        <i class="fas fa-laptop-code"></i>
                        <span>Technologie</span>
                    </div>
                </label>
                
                <label class="category-card">
                    <input type="checkbox" name="topics" value="Filme">
                    <div class="card-content">
                        <i class="fas fa-film"></i>
                        <span>Filme</span>
                    </div>
                </label>
                
                <label class="category-card">
                    <input type="checkbox" name="topics" value="Geographie">
                    <div class="card-content">
                        <i class="fas fa-globe-europe"></i>
                        <span>Geographie</span>
                    </div>
                </label>
                
                <label class="category-card">
                    <input type="checkbox" name="topics" value="Sprache">
                    <div class="card-content">
                        <i class="fas fa-language"></i>
                        <span>Sprache</span>
                    </div>
                </label>
                
                <label class="category-card">
                    <input type="checkbox" name="topics" value="Kunst">
                    <div class="card-content">
                        <i class="fas fa-palette"></i>
                        <span>Kunst</span>
                    </div>
                </label>
                
                <label class="category-card">
                    <input type="checkbox" name="topics" value="Essen">
                    <div class="card-content">
                        <i class="fas fa-utensils"></i>
                        <span>Essen</span>
                    </div>
                </label>
                
                <label class="category-card">
                    <input type="checkbox" name="topics" value="Promis">
                    <div class="card-content">
                        <i class="fas fa-star"></i>
                        <span>Promis</span>
                    </div>
                </label>
                
                <label class="category-card">
                    <input type="checkbox" name="topics" value="Glauben">
                    <div class="card-content">
                        <i class="fas fa-dragon"></i>
                        <span>Mythologie</span>
                    </div>
                </label>
                
                <label class="category-card">
                    <input type="checkbox" name="topics" value="Natur">
                    <div class="card-content">
                        <i class="fas fa-leaf"></i>
                        <span>Natur</span>
                    </div>
                </label>
                
                <label class="category-card">
                    <input type="checkbox" name="topics" value="Wirtschaft">
                    <div class="card-content">
                        <i class="fas fa-chart-line"></i>
                        <span>Wirtschaft</span>
                    </div>
                </label>
                
                <label class="category-card">
                    <input type="checkbox" name="topics" value="Automobil">
                    <div class="card-content">
                        <i class="fas fa-car"></i>
                        <span>Automobil</span>
                    </div>
                </label>
                
                <label class="category-card">
                    <input type="checkbox" name="topics" value="Gaming">
                    <div class="card-content">
                        <i class="fas fa-gamepad"></i>
                        <span>Gaming</span>
                    </div>
                </label>
            </div>
            
            <div class="button-row">
                <a href="{{ url_for('tickets_overview') }}" class="support-button sound-button" aria-label="Support">
                    <i class="fas fa-headset"></i>
                </a>
                
                <button type="submit" class="start-button sound-button">
                    <i class="fas fa-play-circle"></i> Quiz starten
                </button>

                {% if is_admin %}
                <a href="{{ url_for('admin_panel') }}" class="admin-button sound-button" aria-label="Admin Panel">
                    <i class="fas fa-cogs"></i>
                </a>
                {% endif %}
            </div>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const infoButton = document.getElementById('info-button');
        const flashContainer = document.getElementById('flash-container');
        const randomModeCheckbox = document.getElementById('random-mode-checkbox');
        const randomModeInput = document.getElementById('random-mode');
        const categoryCards = document.querySelectorAll('.category-card:not(.random-mode-card)');
        const allCheckboxes = document.querySelectorAll('input[name="topics"]');
        
        // Zufallsmodus Logik
        randomModeCheckbox.addEventListener('change', function() {
            if (this.checked) {
                // Zufallsmodus aktivieren
                randomModeInput.value = 'true';
                categoryCards.forEach(card => {
                    card.classList.add('disabled');
                    const checkbox = card.querySelector('input[type="checkbox"]');
                    checkbox.checked = false;
                    checkbox.disabled = true;
                    
                    // Icons zu Fragezeichen ändern
                    const icon = card.querySelector('i');
                    icon.className = 'fas fa-question';
                });
                
                createFlashMessage('Es werden 30 zufällige Fragen aus einer zufälligen Anzahl von Kategorien ausgewählt.', 'info');
            } else {
                // Zufallsmodus deaktivieren
                randomModeInput.value = 'false';
                categoryCards.forEach(card => {
                    card.classList.remove('disabled');
                    const checkbox = card.querySelector('input[type="checkbox"]');
                    checkbox.disabled = false;
                    
                    // Icons zurückändern
                    const originalIcons = {
                        'Musik': 'fas fa-music',
                        'Geschichte': 'fas fa-landmark',
                        'Sport': 'fas fa-football-ball',
                        'Technologie': 'fas fa-laptop-code',
                        'Filme': 'fas fa-film',
                        'Geographie': 'fas fa-globe-europe',
                        'Sprache': 'fas fa-language',
                        'Kunst': 'fas fa-palette',
                        'Essen': 'fas fa-utensils',
                        'Promis': 'fas fa-star',
                        'Glauben': 'fas fa-dragon',
                        'Natur': 'fas fa-leaf',
                        'Wirtschaft': 'fas fa-chart-line',
                        'Automobil': 'fas fa-car',
                        'Gaming': 'fas fa-gamepad'
                    };
                    
                    const value = checkbox.value;
                    if (originalIcons[value]) {
                        const icon = card.querySelector('i');
                        icon.className = originalIcons[value];
                    }
                });
            }
        });

        // Formular-Submit validieren
        document.getElementById('quiz-form').addEventListener('submit', function(e) {
            const randomMode = randomModeInput.value === 'true';
            const selectedTopics = Array.from(allCheckboxes).filter(cb => cb.checked && cb.value !== 'random');
            
            if (!randomMode && selectedTopics.length === 0) {
                e.preventDefault();
                createFlashMessage('Bitte wähle mindestens ein Thema aus oder aktiviere den Zufallsmodus!', 'error');
                return false;
            }

            if (randomMode) {
                categoryCards.forEach(card => {
                    const checkbox = card.querySelector('input[type="checkbox"]');
                    checkbox.disabled = true;
                    checkbox.checked = false; // Sicherstellen, dass keine Checkbox checked ist
                });
            }
        });
        
        infoButton.addEventListener('click', function() {
            createFlashMessage('Du kannst bis zu 15 Themen gleichzeitig auswählen oder den Zufallsmodus aktivieren!', 'info');
        });
    });
</script>
{% endblock %}