{% extends "base.html" %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/styles_support_requests.css') }}">
{% endblock %}

{% block body %}
<div class="page-wrapper">
    <!-- Titel -->
    <div class="container">
        <h1 class="support-title">Gespeicherte Support-Anfragen</h1>
    </div>

    <!-- Anfragen-Tabelle -->
    <div class="requests-content">
        {% if requests %}
        <table class="requests-table">
            <thead>
                <tr>
                    <th>Kategorie</th>
                    <th>Username</th>
                    <th>Telefon</th>
                    <th>E-Mail</th>
                    <th>Nachricht</th>
                </tr>
            </thead>
            <tbody>
                {% for req in requests %}
                <tr class="request-row" data-id="{{ req.id }}">
                    <td>{{ req.category }}</td>
                    <td>{{ req.username }}</td>
                    <td>{{ req.phone }}</td>
                    <td>{{ req.email }}</td>
                    <td>{{ req.message }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p class="no-requests">üì≠ Es sind noch keine Support-Anfragen gespeichert.</p>
        {% endif %}
    </div>

    <!-- L√∂schmodus-Button -->
    <div class="link-content">
        <button id="toggle-delete-mode" class="requests-button">üóëÔ∏è Eintrag l√∂schen</button>
    </div>

    <!-- Zur√ºck-Button -->
    <div class="link-content">
        <a href="{{ url_for('support') }}" class="requests-button">Zur√ºck zum Support</a>
    </div>
</div>



<!-- JavaScript f√ºr L√∂schmodus -->
<script>
let deleteMode = false;

document.getElementById('toggle-delete-mode').addEventListener('click', () => {
    deleteMode = true;
    document.getElementById('toggle-delete-mode').textContent = deleteMode
        ? 'üö´ L√∂schen abbrechen'
        : 'üóëÔ∏è Eintrag l√∂schen';

    document.querySelectorAll('.request-row').forEach(row => {
        row.style.cursor = deleteMode ? 'pointer' : 'default';
        row.classList.toggle('highlight-delete', deleteMode);
    });
});

document.querySelectorAll('.request-row').forEach(row => {
    row.addEventListener('click', () => {
        if (!deleteMode) return;

        const requestId = row.dataset.id;

        fetch(`/delete_request/${requestId}`, {
            method: 'POST'
        }).then(() => {
            location.reload();
        }).catch(err => {
            alert('Fehler beim L√∂schen');
            console.error(err);
        });
    });
});
</script>
{% endblock %}
